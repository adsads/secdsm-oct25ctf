<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üî§ Spooky Wordle - Halloween Mini CTF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #ff6b6b;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ff6b6b;
            text-shadow: 0 0 10px #ff6b6b;
        }
        
        .subtitle {
            color: #ffd93d;
            margin-bottom: 20px;
        }
        
        .back-link {
            color: #a8e6cf;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .back-link:hover {
            color: #ffd93d;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .game-board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }
        
        .cell {
            width: 60px;
            height: 60px;
            border: 2px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            body { padding: 10px; }
            h1 { font-size: 2rem; }
            .subtitle { font-size: 1rem; }
            .instructions { font-size: 0.9rem; padding: 0 10px; margin-bottom: 15px; }
            .cell { width: 50px; height: 50px; font-size: 1.2rem; }
            .game-container { gap: 15px; }
            .header { margin-bottom: 20px; }
            .game-board { margin-bottom: 15px; }
            .message { font-size: 1rem; margin: 15px 0; }
            .controls { margin: 15px 0; }
            .clear-btn { padding: 8px 16px; font-size: 0.9rem; }
        }

        @media (max-width: 480px) {
            .cell { width: 45px; height: 45px; font-size: 1rem; }
            .keyboard-row { min-width: 280px; gap: 2px; }
            .key { padding: 6px 8px; min-width: 25px; font-size: 0.8rem; border-radius: 3px; }
            .key.wide { padding: 6px 12px; min-width: 40px; }
            h1 { font-size: 1.8rem; }
            .subtitle { font-size: 0.9rem; }
            .instructions { font-size: 0.8rem; line-height: 1.4; }
            .message { font-size: 0.9rem; }
            .clear-btn { padding: 6px 12px; font-size: 0.8rem; }
        }
        
        .cell.filled { border-color: #666; background: rgba(255, 255, 255, 0.2); }
        .cell.correct { background: #4caf50; border-color: #4caf50; color: white; }
        .cell.present { background: #ff9800; border-color: #ff9800; color: white; }
        .cell.absent { background: #666; border-color: #666; color: white; }
        
        .message { text-align: center; margin: 20px 0; font-size: 1.2rem; min-height: 30px; }
        .success { color: #4caf50; animation: glow 1s ease-in-out infinite alternate; }
        .error { color: #f44336; }
        .controls { text-align: center; margin: 20px 0; }
        .clear-btn { background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .clear-btn:hover { background: #ff5252; transform: translateY(-2px); }
        
        .flag { color: #ffd93d; font-weight: bold; margin-top: 20px; padding: 15px; border: 2px solid #ffd93d; border-radius: 10px; background: rgba(255, 217, 61, 0.1); display: none; }
        
        @keyframes glow { from { text-shadow: 0 0 5px currentColor; } to { text-shadow: 0 0 15px currentColor; } }
        
        .instructions { max-width: 600px; text-align: center; margin-bottom: 20px; color: #a8e6cf; line-height: 1.6; }
    </style>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back-link">‚Üê Back to Challenges</a>
        <h1>üî§ Spooky Wordle</h1>
        <div class="subtitle">Guess the Halloween word in 6 tries!</div>
        <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">v2.3 - Mobile Fixed</div>
    </div>
    
    <div class="instructions">
        <p>üéÉ Each guess must be a valid 5-letter word</p>
        <p>üü© Green = Correct letter in correct position</p>
        <p>üü® Orange = Correct letter in wrong position</p>
        <p>‚¨õ Gray = Letter not in the word</p>
        <p>üëª Find the spooky Halloween word to reveal the flag!</p>
    </div>
    
    <div class="game-container">
        <input type="text" id="mobileKeyboard" style="position:absolute; left:-9999px; opacity:0; pointer-events:none; width:1px; height:1px; font-size:16px; z-index:9999;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
        <div id="mobileInput" contenteditable="true" style="position:absolute; left:-9999px; opacity:0; pointer-events:none; width:1px; height:1px; font-size:16px; z-index:9998; outline:none; -webkit-user-select:text;" inputmode="text"></div>
        <div class="game-board" id="gameBoard"></div>
        <div class="message" id="message"></div>
        <button id="mobileTypeBtn" onclick="focusMobileKeyboard()" style="display:none; background:rgba(255,255,255,0.1); border:2px solid #ff6b6b; color:#ff6b6b; padding:8px 16px; border-radius:8px; font-size:0.9rem; cursor:pointer; margin:10px 0;">üì± Tap to Type</button>
        <div class="flag" id="flag">
            <h3>üéâ Congratulations! You found the flag! üéâ</h3>
            <p><strong>Flag:</strong> <code>SecDSM{spooky_wordle_master_2025}</code></p>
        </div>
        <div class="controls">
            <button onclick="clearGame()" class="clear-btn">üßπ Clear Game</button>
        </div>
    </div>

<script>
// Words
const halloweenWords = ['GHOST','WITCH','DEMON','BEAST','SCARE','SPOOK','CREEP','BLOOD','GHOUL','SKULL','GRAVE','TOMBS','HAUNT','CURSE','SPELL','MAGIC','POWER','DEATH','NIGHT','PATCH','TRICK','TREAT','EERIE','SCARY','GOURD','SLIMY'];
let validWords = [];

// Load valid words
async function loadValidWords() {
    try {
        const response = await fetch('valid-wordle-words.txt');
        const text = await response.text();
        validWords = text.trim().split('\n').map(w => w.trim().toUpperCase());
    } catch { validWords = halloweenWords; }
}

const targetWord = halloweenWords[Math.floor(Math.random() * halloweenWords.length)];
let currentRow = 0, currentCol = 0, gameWon = false, gameOver = false;
let gameState = { guesses:[], currentRow:0, currentCol:0, gameWon:false, gameOver:false, targetWord };

function saveGameState() { localStorage.setItem('spookyWordleState', JSON.stringify(gameState)); }

function loadGameState() {
    const saved = localStorage.getItem('spookyWordleState');
    if (saved) { const s=JSON.parse(saved); if(s.targetWord===targetWord){gameState=s; currentRow=s.currentRow; currentCol=s.currentCol; gameWon=s.gameWon; gameOver=s.gameOver; return true;} }
    return false;
}

function initGame() {
    const board=document.getElementById('gameBoard'); board.innerHTML='';
    for(let r=0;r<6;r++){const rowDiv=document.createElement('div'); rowDiv.className='row';
        for(let c=0;c<5;c++){const cell=document.createElement('div'); cell.className='cell'; cell.id=`cell-${r}-${c}`; rowDiv.appendChild(cell);}
        board.appendChild(rowDiv);}
    if(loadGameState()) restoreGameState();
}

function restoreGameState() { gameState.guesses.forEach(g=>{const cell=document.getElementById(`cell-${g.row}-${g.col}`); if(cell){cell.textContent=g.letter; cell.classList.add(...g.classes);}}); if(gameWon) document.getElementById('flag').style.display='block'; }

function handleKeyPress(key) {
    if(gameOver) return;
    if(key==='ENTER'){submitGuess();}
    else if(key==='BACKSPACE'){deleteLetter();}
    else if(key.length===1 && key.match(/[A-Z]/)){addLetter(key);}
}

function addLetter(letter){ if(currentCol<5){const cell=document.getElementById(`cell-${currentRow}-${currentCol}`); cell.textContent=letter; cell.classList.add('filled'); currentCol++;}}
function deleteLetter(){ if(currentCol>0){currentCol--; const cell=document.getElementById(`cell-${currentRow}-${currentCol}`); cell.textContent=''; cell.classList.remove('filled');}}

function submitGuess(){
    if(currentCol!==5){showMessage('Word must be 5 letters!','error');return;}
    let guess=''; for(let c=0;c<5;c++){guess+=document.getElementById(`cell-${currentRow}-${c}`).textContent;}
    if(!validWords.includes(guess)){showMessage('Not a valid word!','error');return;}
    const result=checkGuess(guess,targetWord);
    for(let c=0;c<5;c++){const cell=document.getElementById(`cell-${currentRow}-${c}`); cell.classList.add(result[c]);}
    if(guess===targetWord){gameWon=true; gameOver=true; showMessage('üéâ Spooky word found!','success'); document.getElementById('flag').style.display='block'; saveGameState(); return;}
    currentRow++; currentCol=0;
    if(currentRow>=6){gameOver=true; showMessage(`Game over! The word was: ${targetWord}`,'error');}
    else{showMessage('Keep guessing...','');}
    if(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)){focusMobileKeyboard();}
}

function checkGuess(guess,target){const res=new Array(5).fill('absent'); const t=target.split(''); const g=guess.split(''); for(let i=0;i<5;i++){if(g[i]===t[i]){res[i]='correct'; t[i]=null; g[i]=null;}} for(let i=0;i<5;i++){if(g[i]!==null){const idx=t.indexOf(g[i]); if(idx!==-1){res[i]='present'; t[idx]=null;}}} return res;}

function showMessage(t,cls){const m=document.getElementById('message'); m.textContent=t; m.className=`message ${cls}`;}

function clearGame(){localStorage.removeItem('spookyWordleState'); currentRow=0; currentCol=0; gameWon=false; gameOver=false; document.querySelectorAll('.cell').forEach(c=>{c.textContent=''; c.className='cell';}); document.getElementById('flag').style.display='none'; showMessage('üßπ Game cleared!','');}

// Desktop keyboard only
if(!/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)){
    document.addEventListener('keydown',e=>{if(e.key==='Enter')handleKeyPress('ENTER'); else if(e.key==='Backspace')handleKeyPress('BACKSPACE'); else if(e.key.match(/[a-zA-Z]/))handleKeyPress(e.key.toUpperCase());});
}

// Mobile inputs
const mobileKeyboardInput=document.getElementById('mobileKeyboard');
const mobileInputDiv=document.getElementById('mobileInput');
let activeInputMethod=null;

function handleMobileInput(val,src){if(!val)return; for(let ch of val){if(ch.match(/[a-zA-Z]/i)){handleKeyPress(ch.toUpperCase());}} if(src==='input')mobileKeyboardInput.value=''; else mobileInputDiv.textContent='';}

mobileKeyboardInput.addEventListener('input',e=>{handleMobileInput(e.target.value,'input');});
mobileKeyboardInput.addEventListener('keydown',e=>{if(e.key==='Enter'){handleKeyPress('ENTER'); e.preventDefault();} else if(e.key==='Backspace'){handleKeyPress('BACKSPACE'); e.preventDefault();}});

mobileInputDiv.addEventListener('input',e=>{handleMobileInput(e.target.textContent||'','contenteditable');});
mobileInputDiv.addEventListener('keydown',e=>{if(e.key==='Enter'){handleKeyPress('ENTER'); e.preventDefault();} else if(e.key==='Backspace'){handleKeyPress('BACKSPACE'); e.preventDefault();}});

function focusMobileKeyboard(){if(/iPad|iPhone|iPod/.test(navigator.userAgent)){mobileInputDiv.focus(); activeInputMethod='contenteditable'; setTimeout(()=>{if(document.activeElement!==mobileInputDiv){mobileKeyboardInput.focus(); activeInputMethod='input';}},100);} else if(/Android/i.test(navigator.userAgent)){mobileKeyboardInput.focus(); activeInputMethod='input';}}

document.addEventListener('DOMContentLoaded',()=>{const board=document.getElementById('gameBoard'); const btn=document.getElementById('mobileTypeBtn'); if(/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent))btn.style.display='block'; board.addEventListener('click',focusMobileKeyboard); board.addEventListener('touchstart',focusMobileKeyboard);});

async function initializeGame(){await loadValidWords(); initGame(); showMessage('üéÉ Start guessing Halloween words!','');}
initializeGame();
</script>
</body>
</html>